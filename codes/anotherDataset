{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":67565,"status":"ok","timestamp":1666001062758,"user":{"displayName":"­김동규","userId":"13850968458248669996"},"user_tz":-540},"id":"zXroAH9qbUAM","outputId":"987bdb82-6afc-44e2-eb00-53ae4d932c5f"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive',force_remount=True)\n","assetPath='/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/assets/'\n","dataPath='/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/dataset/'\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4465,"status":"ok","timestamp":1666001110309,"user":{"displayName":"­김동규","userId":"13850968458248669996"},"user_tz":-540},"id":"lZc65AW7eE1A","outputId":"92648c32-7f19-460a-ea4b-731f08eaa785"},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: av in /usr/local/lib/python3.7/dist-packages (9.2.0)\n","400\n"]}],"source":["import torch\n","import torchvision\n","from torchvision import transforms\n","from torch.utils.data import Dataset,DataLoader\n","from torchvision.io import read_video,read_video_timestamps\n","from torch import nn\n","import os\n","import numpy as np\n","import pandas as pd\n","!pip install av\n","import av\n","from torchvision.io import read_image\n","import glob\n","labels=['testifying', 'eating spaghetti', 'dribbling basketball',\n","       'playing tennis', 'tap dancing', 'climbing a rope',\n","       'brushing teeth', 'balloon blowing', 'feeding birds',\n","       'skiing (not slalom or crosscountry)', 'dining', 'hurdling',\n","       'javelin throw', 'pushing wheelchair', 'snowkiting',\n","       'gymnastics tumbling', 'petting animal (not cat)',\n","       'biking through snow', 'drinking', 'sword fighting',\n","       'making snowman', 'somersaulting', 'playing harmonica',\n","       'passing American football (not in game)', 'clay pottery making',\n","       'shaving legs', 'golf chipping', 'cooking chicken',\n","       'hurling (sport)', 'yawning', 'shaking hands',\n","       'canoeing or kayaking', 'hula hooping', 'changing oil', 'sailing',\n","       'playing paintball', 'stretching arm', 'snowboarding',\n","       'skipping rope', 'getting a haircut', 'windsurfing',\n","       'golf putting', 'zumba', 'eating watermelon',\n","       'shooting basketball', 'unboxing', 'marching', 'making bed',\n","       'sanding floor', 'flying kite', 'playing poker',\n","       'giving or receiving award', 'pole vault', 'shoveling snow',\n","       'climbing ladder', 'dancing ballet', 'baking cookies',\n","       'cooking egg', 'hitting baseball',\n","       'passing American football (in game)', 'dancing charleston',\n","       'headbanging', 'peeling potatoes', 'drumming fingers',\n","       'smoking hookah', 'archery', 'motorcycling', 'walking the dog',\n","       'shearing sheep', 'welding', 'singing', 'knitting', 'mowing lawn',\n","       'blasting sand', 'swinging legs', 'making jewelry',\n","       'tapping guitar', 'cartwheeling', 'golf driving', 'milking cow',\n","       'punching bag', 'playing accordion', 'ice climbing', 'auctioning',\n","       'drop kicking', 'busking', 'ironing', 'waxing back',\n","       'catching or throwing softball', 'weaving basket',\n","       'getting a tattoo', 'air drumming', 'playing ukulele', 'abseiling',\n","       'playing guitar', 'playing drums', 'carrying baby', 'bandaging',\n","       'playing trumpet', 'springboard diving', 'celebrating',\n","       'tossing coin', 'using remote controller (not gaming)',\n","       'presenting weather forecast', 'ice skating', 'shuffling cards',\n","       'contact juggling', 'smoking', 'jumping into pool', 'barbequing',\n","       'picking fruit', 'tying tie', 'bookbinding',\n","       'riding mechanical bull', 'riding mule', 'playing monopoly',\n","       'squat', 'sharpening pencil', 'playing harp', 'shaking head',\n","       'catching fish', 'shot put', 'kitesurfing', 'spinning poi',\n","       'crawling baby', 'country line dancing', 'cheerleading',\n","       'spray painting', 'arm wrestling', 'roller skating',\n","       'playing bass guitar', 'playing trombone', 'skydiving',\n","       'climbing tree', 'riding elephant', 'snowmobiling', 'vault',\n","       'tai chi', 'trimming trees', 'breakdancing', 'pull ups',\n","       'playing basketball', 'gargling', 'playing bagpipes',\n","       'blowing out candles', 'riding camel', 'grooming horse',\n","       'riding scooter', 'building shed', 'doing nails', 'front raises',\n","       'bending back', 'capoeira', 'using computer', 'washing feet',\n","       'extinguishing fire', 'changing wheel', 'waxing legs',\n","       'playing recorder', 'playing organ', 'waiting in line',\n","       'dodgeball', 'wrapping present', 'sled dog racing', 'pushing car',\n","       'hammer throw', 'whistling', 'faceplanting',\n","       'punching person (boxing)', 'swimming butterfly stroke',\n","       'feeding fish', 'opening present', 'dancing macarena', 'trapezing',\n","       'shining shoes', 'parasailing', 'pumping fist', 'strumming guitar',\n","       'snorkeling', 'eating cake', 'clean and jerk', 'rock climbing',\n","       'dunking basketball', 'playing saxophone', 'watering plants',\n","       'eating doughnuts', 'flipping pancake', 'checking tires',\n","       'eating ice cream', 'folding napkins', 'krumping',\n","       'playing controller', 'water skiing', 'tobogganing',\n","       'playing cello', 'filling eyebrows', 'tossing salad',\n","       'trimming or shaving beard', 'tying bow tie', 'cooking sausages',\n","       'scuba diving', 'swimming backstroke', 'throwing axe',\n","       'cleaning windows', 'parkour', 'long jump',\n","       'snatch weight lifting', 'baby waking up', 'cleaning floor',\n","       'tango dancing', 'bowling', 'surfing crowd', 'using segway',\n","       'playing squash or racquetball', 'robot dancing', 'blowing nose',\n","       'playing didgeridoo', 'kicking field goal', 'playing cards',\n","       'lunge', 'shaving head', 'planting trees', 'diving cliff',\n","       'hockey stop', 'high jump', 'grooming dog', 'reading newspaper',\n","       'salsa dancing', 'taking a shower', 'catching or throwing frisbee',\n","       'riding or walking with horse', 'feeding goats', 'throwing discus',\n","       'bee keeping', 'playing chess', 'massaging back', 'playing piano',\n","       'petting cat', 'stretching leg', 'opening bottle',\n","       'playing violin', 'cleaning gutters', 'slacklining',\n","       'carving pumpkin', 'making sushi', 'bench pressing', 'crying',\n","       'skateboarding', 'reading book', 'high kick', 'digging', 'push up',\n","       'riding unicycle', 'swimming breast stroke', 'counting money',\n","       'sign language interpreting', 'disc golfing', 'finger snapping',\n","       'bungee jumping', 'cutting watermelon', 'cooking on campfire',\n","       'making pizza', 'playing cymbals', 'cleaning shoes',\n","       'breading or breadcrumbing', 'hopscotch', 'massaging feet',\n","       'peeling apples', 'laughing', 'eating carrots', 'blowing glass',\n","       'headbutting', 'sticking tongue out', 'pushing cart',\n","       'playing clarinet', 'cleaning pool', 'triple jump',\n","       'bouncing on trampoline', 'news anchoring', 'clapping',\n","       'tapping pen', 'braiding hair', 'decorating the christmas tree',\n","       'dying hair', 'tasting beer', 'catching or throwing baseball',\n","       'waxing chest', 'riding a bike', 'juggling fire', 'holding snake',\n","       'chopping wood', 'belly dancing', 'writing', 'frying vegetables',\n","       'eating burger', 'playing xylophone', 'driving car',\n","       'kicking soccer ball', 'brushing hair', 'scrambling eggs',\n","       'folding clothes', 'curling hair', 'yoga', 'playing volleyball',\n","       'skiing crosscountry', 'tying knot (not on a tie)', 'slapping',\n","       'spraying', 'washing hands', 'tasting food', 'playing badminton',\n","       'surfing water', 'eating chips', 'recording music',\n","       'waxing eyebrows', 'throwing ball', 'driving tractor', 'side kick',\n","       'playing ice hockey', 'jumpstyle dancing', 'situp', 'jogging',\n","       'running on treadmill', 'juggling soccer ball', 'unloading truck',\n","       'texting', 'cleaning toilet', 'applying cream', 'sweeping floor',\n","       'ski jumping', 'assembling computer', 'playing keyboard',\n","       'arranging flowers', 'ripping paper', 'laying bricks',\n","       'training dog', 'deadlifting', 'sharpening knives', 'beatboxing',\n","       'answering questions', 'egg hunting', 'drinking shots',\n","       'garbage collecting', 'eating hotdog', 'mopping floor',\n","       'bartending', 'grinding meat', 'jetskiing', 'folding paper',\n","       'playing kickball', 'riding mountain bike', 'bending metal',\n","       'juggling balls', 'making a cake', 'hugging', 'fixing hair',\n","       'washing dishes', 'ice fishing', 'exercising arm', 'tickling',\n","       'crossing river', 'playing cricket', 'building cabinet',\n","       'sneezing', 'moving furniture', 'stomping grapes', 'setting table',\n","       'paragliding', 'hoverboarding', 'making a sandwich',\n","       'doing aerobics', 'doing laundry', 'pumping gas',\n","       'cutting pineapple', 'brush painting', 'making tea',\n","       'water sliding', 'drinking beer', 'dancing gangnam style',\n","       'swinging on something', 'swing dancing', 'blowing leaves',\n","       'rock scissors paper', 'shooting goal (soccer)', 'sniffing',\n","       'skiing slalom', 'plastering', 'exercising with an exercise ball',\n","       'cracking neck', 'cutting nails', 'shredding paper',\n","       'playing flute', 'washing hair', 'bobsledding', 'applauding',\n","       \"massaging person's head\", 'kissing', 'massaging legs',\n","       'wrestling', 'drawing']\n","print(len(labels))\n","label_hash={}\n","i=0\n","for label in labels:\n","  label_hash[label]=i\n","  i+=1"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oD_88cSDXxwk"},"outputs":[],"source":["num=0\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ZqWzapGiW25x","executionInfo":{"status":"ok","timestamp":1666022973085,"user_tz":-540,"elapsed":112674,"user":{"displayName":"­김동규","userId":"13850968458248669996"}},"outputId":"f785702b-0fdc-46b5-d530-84d03d915330"},"outputs":[{"output_type":"stream","name":"stdout","text":["bash: cannot set terminal process group (54): Inappropriate ioctl for device\n","bash: no job control in this shell\n","\u001b[01;34m/content\u001b[00m# dir\n","drive  sample_data\n","\u001b[01;34m/content\u001b[00m# cd drive\n","\u001b[01;34m/content/drive\u001b[00m# cd MyDrive\n","\u001b[01;34m/content/drive/MyDrive\u001b[00m# cd 'Colab Notebookss'\n","bash: cd: Colab Notebookss: No such file or directory\n","\u001b[01;34m/content/drive/MyDrive\u001b[00m# cd 'Colab Notebooks'\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks\u001b[00m# cd whfvm\n","bash: cd: whfvm: No such file or directory\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks\u001b[00m# cd whfvm\n","bash: cd: whfvm: No such file or directory\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks\u001b[00m# dir\n","졸프\t\t\thumanpose2\t\t\ttest\n","anotherDataset\t\thumanpose2의\\ 사본\t\tUntitled\n","anotherDataset의\\ 사본\tkinetic_preprocess\n","datadownloader\t\tplot_visualization_utils.ipynb\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks\u001b[00m# cd whfvm\n","bash: cd: whfvm: No such file or directory\n","ks/졸프/pose_estimation/'\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation\u001b[00m# dir\n","annotationData\tassets.npy  dataset3   kineticData  output.mp4\ttempfolder.zip\n","assets\t\tdataset     humanpose  model\t    sample.mp4\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation\u001b[00m# cd kineticData\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/kineticData\u001b[00m# dir\n","복사본.json의\\ 사본  scores.json\t       scores.json의\\ 사본\\ (2)\n","sampling_score.json  scores.json의\\ 사본       train\n","scores\t\t     scores.json의\\ 사본\\ (1)  val\n","\u001b[01;34m/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/kineticData\u001b[00m# cd val\n","\u001b[A\n","ssaging legs'  'wrestling'  'drawing'\n","t\n","exit\n"]}],"source":["!bash\n","\n","#!mkdir '/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/newdataset2/train/part_'$num\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5198948,"status":"ok","timestamp":1666007034328,"user":{"displayName":"­김동규","userId":"13850968458248669996"},"user_tz":-540},"id":"J-Kce7yYyCR_","outputId":"3b46bfe2-adef-4e08-e858-f696d0105040"},"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/dataset/val/\n","/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/dataset/val.csv\n","21\n","19881\n","0/19881\n","500/19881\n","1000/19881\n","1500/19881\n","2000/19881\n","2500/19881\n","3000/19881\n","3500/19881\n","4000/19881\n","4500/19881\n","5000/19881\n","5500/19881\n","6000/19881\n","6500/19881\n","7000/19881\n","7500/19881\n","8000/19881\n","8500/19881\n","9000/19881\n","9500/19881\n","10000/19881\n","10500/19881\n","11000/19881\n","11500/19881\n","12000/19881\n","12500/19881\n","13000/19881\n","13500/19881\n","14000/19881\n","14500/19881\n","15000/19881\n","15500/19881\n","16000/19881\n","16500/19881\n","17000/19881\n","17500/19881\n","18000/19881\n","18500/19881\n","19000/19881\n","19500/19881\n"]}],"source":["path=dataPath+'val/'\n","print(path)\n","import shutil\n","csv_file=dataPath+'val.csv'\n","print(csv_file)\n","df=pd.read_csv(csv_file)\n","\n","videos=[]\n","folderList=os.listdir(path)\n","print(len(folderList))\n","for folder in folderList:\n","    videos+=glob.glob(path+folder+'/*')\n","\n","   \n","\n","print(len(videos))\n","tpath='/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/annotationData/val/'\n","i=0  \n","for video in videos:\n","  \n","  #  print(video)\n","    #video=video.split('/')\n","    if(i%500==0):\n","        print(str(i)+'/'+str(len(videos)))\n","    i+=1\n","    videon=video.split('/')[-1]\n","    videon=videon.split('_')\n","    videon=\"_\".join(videon[:-2])\n","    videon=videon.split('\\\\')[-1]\n","    \n","    annotation=df.loc[df['youtube_id']==videon]['label'].values[0]\n","\n","    # print('D:/졸프/tempfolder'+annotation+'/'+videon+'.mp4')\n","    #print(video)\n","    #print(tpath+annotation+'/'+videon+'.mp4')\n","    shutil.copy(video,tpath+annotation+'/'+videon+'.mp4')\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"z4Sovpaqc_Lr"},"outputs":[],"source":["%cd /content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/\n","import pickle\n","import numpy as np\n","import cv2\n","from time import time\n","\n","dataset='dataset/val/part_'\n","\n","\n","for num in range(num,21):\n","  targetfolder='newdataset/val/part_'+str(num)+'/'\n","  folder=dataset+str(num)+'/'\n","  file_list=os.listdir(folder)\n","  index=0\n","  print(len(file_list))\n","  print(num)\n","  print(folder)\n","  print(targetfolder)\n","\n","  for file in file_list:\n","    file_name=\"_\".join(file.split('/')[-1].split('_')[:-2])\n","    cur_time=time()\n","    frames,_,_=read_video(dataset+str(num)+'/'+file)\n","    if len(frames)==0:\n","      print(file_name)\n","      continue\n","    #print(\"torch time:\"+str(time()-cur_time))\n","\n","\n","    before=len(frames)\n","\n","  # cur_time=time()\n","\n","\n","    frames = frames.permute(0, 3, 1, 2)\n","  # print(frames.shape)\n","    transform=transforms.Resize((112,112))\n","\n","\n","\n","    sampling=np.arange(60,dtype='float32')\n","    #print(sampling)\n","    sampling*=len(frames)/float(60)\n","    #print(sampling)\n","    sampling=sampling.astype('int32')\n","  # print(sampling)\n","\n","    frames=frames[sampling]\n","\n","    frames=transform(frames)\n","    frames=frames.numpy()\n","  #  print(frames.shape)\n","\n","    if len(frames)>before:\n","      print(file_name)\n","      print(len(frames),before)\n","\n","\n","    if index%100==0:\n","      print(str(index)+'/'+str(len(file_list)))\n","    with open(targetfolder+file_name,'wb') as f:\n","      pickle.dump(frames,f)\n","    #np.save(targetfolder+file_name,frames)\n","    index+=1\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1295,"status":"ok","timestamp":1662385297865,"user":{"displayName":"­김동규","userId":"13850968458248669996"},"user_tz":-540},"id":"UyFwP10rzr08","outputId":"a58f8feb-bcc4-4a95-aaf8-1f55be2ca9cd"},"outputs":[{"name":"stdout","output_type":"stream","text":["/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/newdataset/val\n","400\n","/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/dataset/val .csv\n","/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/newdataset/val/\n","21\n","19876\n"]}],"source":["import torch\n","import torchvision\n","from torchvision import transforms\n","from torch.utils.data import Dataset,DataLoader\n","from torchvision.io import read_video,read_video_timestamps\n","from torch import nn\n","import os\n","import numpy as mp\n","import pandas as pd\n","import av\n","from torchvision.io import read_image\n","import glob\n","from time import time\n","import pickle\n","# %cd '/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/dataset/train/'\n","%cd '/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/newdataset/val/'\n","labels=['testifying', 'eating spaghetti', 'dribbling basketball',\n","       'playing tennis', 'tap dancing', 'climbing a rope',\n","       'brushing teeth', 'balloon blowing', 'feeding birds',\n","       'skiing (not slalom or crosscountry)', 'dining', 'hurdling',\n","       'javelin throw', 'pushing wheelchair', 'snowkiting',\n","       'gymnastics tumbling', 'petting animal (not cat)',\n","       'biking through snow', 'drinking', 'sword fighting',\n","       'making snowman', 'somersaulting', 'playing harmonica',\n","       'passing American football (not in game)', 'clay pottery making',\n","       'shaving legs', 'golf chipping', 'cooking chicken',\n","       'hurling (sport)', 'yawning', 'shaking hands',\n","       'canoeing or kayaking', 'hula hooping', 'changing oil', 'sailing',\n","       'playing paintball', 'stretching arm', 'snowboarding',\n","       'skipping rope', 'getting a haircut', 'windsurfing',\n","       'golf putting', 'zumba', 'eating watermelon',\n","       'shooting basketball', 'unboxing', 'marching', 'making bed',\n","       'sanding floor', 'flying kite', 'playing poker',\n","       'giving or receiving award', 'pole vault', 'shoveling snow',\n","       'climbing ladder', 'dancing ballet', 'baking cookies',\n","       'cooking egg', 'hitting baseball',\n","       'passing American football (in game)', 'dancing charleston',\n","       'headbanging', 'peeling potatoes', 'drumming fingers',\n","       'smoking hookah', 'archery', 'motorcycling', 'walking the dog',\n","       'shearing sheep', 'welding', 'singing', 'knitting', 'mowing lawn',\n","       'blasting sand', 'swinging legs', 'making jewelry',\n","       'tapping guitar', 'cartwheeling', 'golf driving', 'milking cow',\n","       'punching bag', 'playing accordion', 'ice climbing', 'auctioning',\n","       'drop kicking', 'busking', 'ironing', 'waxing back',\n","       'catching or throwing softball', 'weaving basket',\n","       'getting a tattoo', 'air drumming', 'playing ukulele', 'abseiling',\n","       'playing guitar', 'playing drums', 'carrying baby', 'bandaging',\n","       'playing trumpet', 'springboard diving', 'celebrating',\n","       'tossing coin', 'using remote controller (not gaming)',\n","       'presenting weather forecast', 'ice skating', 'shuffling cards',\n","       'contact juggling', 'smoking', 'jumping into pool', 'barbequing',\n","       'picking fruit', 'tying tie', 'bookbinding',\n","       'riding mechanical bull', 'riding mule', 'playing monopoly',\n","       'squat', 'sharpening pencil', 'playing harp', 'shaking head',\n","       'catching fish', 'shot put', 'kitesurfing', 'spinning poi',\n","       'crawling baby', 'country line dancing', 'cheerleading',\n","       'spray painting', 'arm wrestling', 'roller skating',\n","       'playing bass guitar', 'playing trombone', 'skydiving',\n","       'climbing tree', 'riding elephant', 'snowmobiling', 'vault',\n","       'tai chi', 'trimming trees', 'breakdancing', 'pull ups',\n","       'playing basketball', 'gargling', 'playing bagpipes',\n","       'blowing out candles', 'riding camel', 'grooming horse',\n","       'riding scooter', 'building shed', 'doing nails', 'front raises',\n","       'bending back', 'capoeira', 'using computer', 'washing feet',\n","       'extinguishing fire', 'changing wheel', 'waxing legs',\n","       'playing recorder', 'playing organ', 'waiting in line',\n","       'dodgeball', 'wrapping present', 'sled dog racing', 'pushing car',\n","       'hammer throw', 'whistling', 'faceplanting',\n","       'punching person (boxing)', 'swimming butterfly stroke',\n","       'feeding fish', 'opening present', 'dancing macarena', 'trapezing',\n","       'shining shoes', 'parasailing', 'pumping fist', 'strumming guitar',\n","       'snorkeling', 'eating cake', 'clean and jerk', 'rock climbing',\n","       'dunking basketball', 'playing saxophone', 'watering plants',\n","       'eating doughnuts', 'flipping pancake', 'checking tires',\n","       'eating ice cream', 'folding napkins', 'krumping',\n","       'playing controller', 'water skiing', 'tobogganing',\n","       'playing cello', 'filling eyebrows', 'tossing salad',\n","       'trimming or shaving beard', 'tying bow tie', 'cooking sausages',\n","       'scuba diving', 'swimming backstroke', 'throwing axe',\n","       'cleaning windows', 'parkour', 'long jump',\n","       'snatch weight lifting', 'baby waking up', 'cleaning floor',\n","       'tango dancing', 'bowling', 'surfing crowd', 'using segway',\n","       'playing squash or racquetball', 'robot dancing', 'blowing nose',\n","       'playing didgeridoo', 'kicking field goal', 'playing cards',\n","       'lunge', 'shaving head', 'planting trees', 'diving cliff',\n","       'hockey stop', 'high jump', 'grooming dog', 'reading newspaper',\n","       'salsa dancing', 'taking a shower', 'catching or throwing frisbee',\n","       'riding or walking with horse', 'feeding goats', 'throwing discus',\n","       'bee keeping', 'playing chess', 'massaging back', 'playing piano',\n","       'petting cat', 'stretching leg', 'opening bottle',\n","       'playing violin', 'cleaning gutters', 'slacklining',\n","       'carving pumpkin', 'making sushi', 'bench pressing', 'crying',\n","       'skateboarding', 'reading book', 'high kick', 'digging', 'push up',\n","       'riding unicycle', 'swimming breast stroke', 'counting money',\n","       'sign language interpreting', 'disc golfing', 'finger snapping',\n","       'bungee jumping', 'cutting watermelon', 'cooking on campfire',\n","       'making pizza', 'playing cymbals', 'cleaning shoes',\n","       'breading or breadcrumbing', 'hopscotch', 'massaging feet',\n","       'peeling apples', 'laughing', 'eating carrots', 'blowing glass',\n","       'headbutting', 'sticking tongue out', 'pushing cart',\n","       'playing clarinet', 'cleaning pool', 'triple jump',\n","       'bouncing on trampoline', 'news anchoring', 'clapping',\n","       'tapping pen', 'braiding hair', 'decorating the christmas tree',\n","       'dying hair', 'tasting beer', 'catching or throwing baseball',\n","       'waxing chest', 'riding a bike', 'juggling fire', 'holding snake',\n","       'chopping wood', 'belly dancing', 'writing', 'frying vegetables',\n","       'eating burger', 'playing xylophone', 'driving car',\n","       'kicking soccer ball', 'brushing hair', 'scrambling eggs',\n","       'folding clothes', 'curling hair', 'yoga', 'playing volleyball',\n","       'skiing crosscountry', 'tying knot (not on a tie)', 'slapping',\n","       'spraying', 'washing hands', 'tasting food', 'playing badminton',\n","       'surfing water', 'eating chips', 'recording music',\n","       'waxing eyebrows', 'throwing ball', 'driving tractor', 'side kick',\n","       'playing ice hockey', 'jumpstyle dancing', 'situp', 'jogging',\n","       'running on treadmill', 'juggling soccer ball', 'unloading truck',\n","       'texting', 'cleaning toilet', 'applying cream', 'sweeping floor',\n","       'ski jumping', 'assembling computer', 'playing keyboard',\n","       'arranging flowers', 'ripping paper', 'laying bricks',\n","       'training dog', 'deadlifting', 'sharpening knives', 'beatboxing',\n","       'answering questions', 'egg hunting', 'drinking shots',\n","       'garbage collecting', 'eating hotdog', 'mopping floor',\n","       'bartending', 'grinding meat', 'jetskiing', 'folding paper',\n","       'playing kickball', 'riding mountain bike', 'bending metal',\n","       'juggling balls', 'making a cake', 'hugging', 'fixing hair',\n","       'washing dishes', 'ice fishing', 'exercising arm', 'tickling',\n","       'crossing river', 'playing cricket', 'building cabinet',\n","       'sneezing', 'moving furniture', 'stomping grapes', 'setting table',\n","       'paragliding', 'hoverboarding', 'making a sandwich',\n","       'doing aerobics', 'doing laundry', 'pumping gas',\n","       'cutting pineapple', 'brush painting', 'making tea',\n","       'water sliding', 'drinking beer', 'dancing gangnam style',\n","       'swinging on something', 'swing dancing', 'blowing leaves',\n","       'rock scissors paper', 'shooting goal (soccer)', 'sniffing',\n","       'skiing slalom', 'plastering', 'exercising with an exercise ball',\n","       'cracking neck', 'cutting nails', 'shredding paper',\n","       'playing flute', 'washing hair', 'bobsledding', 'applauding',\n","       \"massaging person's head\", 'kissing', 'massaging legs',\n","       'wrestling', 'drawing']\n","print(len(labels))\n","label_hash={}\n","i=0\n","for label in labels:\n","  label_hash[label]=i\n","  i+=1\n","\n","\n","tsfm=nn.Sequential(\n","    transforms.Resize(size=(112,112)),\n","\n",")\n","\n","\n","class CustomKinetics( Dataset):\n","  def __init__(self,path,csv_file,transform=tsfm,preprocessed=True):\n","\n","    print(csv_file)\n","    self.df=pd.read_csv(csv_file)\n","    self.path=path\n","    self.folderList=os.listdir(self.path)\n","    self.videos=[]\n","\n","    for folder in self.folderList:\n","      self.videos+=glob.glob(folder+'/*')\n","       \n","    self.transform=tsfm\n","    self.preprocessed=preprocessed\n","\n","    print(self.path)\n","    print(len(self.folderList)) \n","    print(len(self.videos))\n","    \n","\n","  def __len__(self):\n","    return len(self.videos)\n","\n","  def __getitem__(self, idx):\n","      if torch.is_tensor(idx):\n","        idx=idx.tolist()\n","      videofile=self.videos[idx]\n","     # print(videofile)\n","      if self.preprocessed == True:\n","        with open(self.path+videofile,'rb') as f:\n","          frames=pickle.load(f)\n","        frames=torch.tensor(frames)\n","\n","        video_name=videofile.split('/')[1]\n","       # print(video_name)\n","        index=self.df.loc[self.df['youtube_id']==video_name]\n","        #print(len(index))\n","        if(len(index)==0):\n","          return videofile\n","        return 0\n","        annotation=self.df.loc[self.df['youtube_id']==video_name]['label'].values[0]\n","\n","        return 0\n","\n","\n","\n","      return frame_float,label\n","def collate_fn(batch):\n","    batch = list(filter(lambda x: x is not None, batch))\n","    return torch.utils.data.dataloader.default_collate(batch)\n","type='val/'\n","path=dataPath+type\n","preprocessedPath='/content/drive/MyDrive/Colab Notebooks/졸프/pose_estimation/newdataset/'+type\n","csv=dataPath+'val .csv'\n","training_data=CustomKinetics(path=preprocessedPath,csv_file=csv,preprocessed=True)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":398},"executionInfo":{"elapsed":267274,"status":"error","timestamp":1662385746757,"user":{"displayName":"­김동규","userId":"13850968458248669996"},"user_tz":-540},"id":"jhE96ZvG0FfH","outputId":"3e7f9719-f9e4-4e31-e5c9-4c56a541d973"},"outputs":[{"ename":"KeyboardInterrupt","evalue":"ignored","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-13-fb5799f9ae16>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      2\u001b[0m \u001b[0mstr\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0mnum\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m0\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 4\u001b[0;31m \u001b[0;32mfor\u001b[0m \u001b[0mstep\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mdata\u001b[0m \u001b[0;32min\u001b[0m \u001b[0menumerate\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtrain_dataloader\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      5\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      6\u001b[0m   \u001b[0;32mif\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdata\u001b[0m\u001b[0;34m==\u001b[0m\u001b[0;36m0\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/utils/data/dataloader.py\u001b[0m in \u001b[0;36m__next__\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    679\u001b[0m                 \u001b[0;31m# TODO(https://github.com/pytorch/pytorch/issues/76750)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    680\u001b[0m                 \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_reset\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# type: ignore[call-arg]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 681\u001b[0;31m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_next_data\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    682\u001b[0m             \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_num_yielded\u001b[0m \u001b[0;34m+=\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    683\u001b[0m             \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_dataset_kind\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0m_DatasetKind\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mIterable\u001b[0m \u001b[0;32mand\u001b[0m\u001b[0;31m \u001b[0m\u001b[0;31m\\\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/utils/data/dataloader.py\u001b[0m in \u001b[0;36m_next_data\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    719\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0m_next_data\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    720\u001b[0m         \u001b[0mindex\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_next_index\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# may raise StopIteration\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 721\u001b[0;31m         \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_dataset_fetcher\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfetch\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mindex\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# may raise StopIteration\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    722\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_pin_memory\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    723\u001b[0m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0m_utils\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpin_memory\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpin_memory\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdata\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_pin_memory_device\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/utils/data/_utils/fetch.py\u001b[0m in \u001b[0;36mfetch\u001b[0;34m(self, possibly_batched_index)\u001b[0m\n\u001b[1;32m     47\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mfetch\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     48\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mauto_collation\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 49\u001b[0;31m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0midx\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0midx\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     50\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     51\u001b[0m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/utils/data/_utils/fetch.py\u001b[0m in \u001b[0;36m<listcomp>\u001b[0;34m(.0)\u001b[0m\n\u001b[1;32m     47\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mfetch\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     48\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mauto_collation\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 49\u001b[0;31m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0midx\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0midx\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     50\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     51\u001b[0m             \u001b[0mdata\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdataset\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mpossibly_batched_index\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m<ipython-input-7-2754b7fc759d>\u001b[0m in \u001b[0;36m__getitem__\u001b[0;34m(self, idx)\u001b[0m\n\u001b[1;32m    181\u001b[0m       \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpreprocessed\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    182\u001b[0m         \u001b[0;32mwith\u001b[0m \u001b[0mopen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m+\u001b[0m\u001b[0mvideofile\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m'rb'\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0mf\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 183\u001b[0;31m           \u001b[0mframes\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mpickle\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mload\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mf\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    184\u001b[0m         \u001b[0mframes\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtensor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mframes\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    185\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}],"source":["train_dataloader=DataLoader(training_data,batch_size=1,shuffle=False)\n","str=\"\"\n","num=0\n","for step,data in enumerate(train_dataloader):\n","\n","  if(data==0):\n","    continue\n","  if((step%100)==0):\n","    print(str(step)+\"/\"+str(len(train_dataloader)))\n","  str+=\" ./\"+data[0]\n","  print(data[0])\n","  num+=1"]}],"metadata":{"colab":{"collapsed_sections":[],"provenance":[],"authorship_tag":"ABX9TyPw7uEAZMgFhVKrB4n4IE8y"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}